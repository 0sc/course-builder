{#
# macro to render a unit title along with a progress indicator
#}
{% macro render_unit_title(
    unit, progress, is_progress_recorded, transient_student, is_course_admin,
    include_link=True) -%}
    {% if unit.now_available or is_course_admin %}
      {% if unit.type == 'A' %}
        <li class='gcb-unit-title'><p class="gcb-top-content">
          {% if not transient_student %}
            {% if progress[unit.unit_id] > 0 %}
              <img src="assets/lib/completed.png"
                   alt="{# I18N: Alt text for image representing student progress. #}{{ gettext('Completed') }}"
                   title="{# I18N: Alt text for image representing student progress. #}{{ gettext('Completed') }}"
                   class="gcb-progress-icon"
                   id="progress-completed-{{unit.unit_id}}">
            {% else %}
              <img src="assets/lib/not_started.png"
                   alt="{# I18N: Alt text for image representing student progress. #}{{ gettext('Not yet submitted') }}"
                   title="{# I18N: Alt text for image representing student progress. #}{{ gettext('Not yet submitted') }}"
                   class="gcb-progress-icon"
                   id="progress-notstarted-{{unit.unit_id}}">
            {% endif %}
          {% else %}
            <span class="gcb-progress-empty"></span>
          {% endif %}
          {% if include_link %}
              <a href="assessment?name={{ unit.unit_id }}">{{ unit.title }}</a>
          {% else %}
              {{ unit.title }}
          {% endif %}
          {% if unit.needs_human_grader %}
            {% if not unit.now_available and is_course_admin %}
              (Private)
            {% endif %}
            </p></li>
            <li>
              <p class="gcb-top-content">
                <span class="gcb-progress-empty"></span>

              {% if not transient_student %}
                {% if unit.review_progress == 2 %}
                  <img src="assets/lib/completed.png"
                       alt="{# I18N: Alt text for image representing student progress. #}{{ gettext('Completed') }}"
                       title="{# I18N: Alt text for image representing student progress. #}{{ gettext('Completed') }}"
                       class="gcb-progress-icon"
                       id="progress-completed-review-{{unit.unit_id}}">
                {% elif unit.review_progress == 1 %}
                  <img src="assets/lib/in_progress.png"
                       alt="{# I18N: Alt text for image representing student progress. #}{{ gettext('In progress') }}"
                       title="{# I18N: Alt text for image representing student progress. #}{{ gettext('In progress') }}"
                       class="gcb-progress-icon"
                       id="progress-inprogress-review-{{unit.unit_id}}">
                {% else %}
                  <img src="assets/lib/not_started.png"
                       alt="{# I18N: Alt text for image representing student progress. #}{{ gettext('Not yet submitted') }}"
                       title="{# I18N: Alt text for image representing student progress. #}{{ gettext('Not yet submitted') }}"
                       class="gcb-progress-icon"
                       id="progress-notstarted-review-{{unit.unit_id}}">
                {% endif %}
              {% endif %}

              {% if unit.is_submitted %}
                <a href="reviewdashboard?unit={{ unit.unit_id }}">
                  {% if unit.matcher == 'peer' %}
                    {# I18N: Displayed in the course contents page. Indicates a page to which students can go to review other students' assignments. #}
                    {{ gettext('Review peer assignments') }}
                  {% endif %}
                </a>
              {% else %}
                <span>
                  {% if unit.matcher == 'peer' %}
                    {# I18N: Displayed in the course contents page. Indicates a page to which students can go to review other students' assignments. #}
                    {{ gettext('Review peer assignments') }}
                  {% endif %}
                </span>
              {% endif %}

          {% endif %}

      {% elif unit.type == 'U' %}
        <li class='gcb-unit-title'><p class="gcb-top-content">
          {% if is_progress_recorded and not transient_student %}
            {% if progress[unit.unit_id] == 2 %}
              <img src="assets/lib/completed.png"
                   alt="{# I18N: Alt text for image representing student progress. #}{{ gettext('Completed') }}"
                   title="{# I18N: Alt text for image representing student progress. #}{{ gettext('Completed') }}"
                   class="gcb-progress-icon"
                   id="progress-completed-{{unit.unit_id}}">
            {% elif progress[unit.unit_id] == 1 %}
              <img src="assets/lib/in_progress.png"
                   alt="{# I18N: Alt text for image representing student progress. #}{{ gettext('In progress') }}"
                   title="{# I18N: Alt text for image representing student progress. #}{{ gettext('In progress') }}"
                   class="gcb-progress-icon"
                   id="progress-inprogress-{{unit.unit_id}}">
            {% else %}
              <img src="assets/lib/not_started.png"
                   alt="{# I18N: Alt text for image representing student progress. #}{{ gettext('Not yet started') }}"
                   title="{# I18N: Alt text for image representing student progress. #}{{ gettext('Not yet started') }}"
                   class="gcb-progress-icon"
                   id="progress-notstarted-{{unit.unit_id}}">
            {% endif %}
          {% else %}
            <span class="gcb-progress-empty"></span>
          {% endif %}

          {% if include_link %}
              <a href="unit?unit={{ unit.unit_id }}">{{ display_unit_title(unit) }}</a>
          {% else %}
              {{ display_unit_title(unit) }}
          {% endif %}
      {% elif unit.type == 'O' %}
        <li class='gcb-unit-title'>
          <p class="gcb-top-content">
            <span class="gcb-progress-empty"></span>
            {% if include_link %}
                <a href="{{ unit.href }}"> {{ unit.title }}</a>
            {% else %}
                {{ unit.title }}
            {% endif %}
      {% else %}
        <li class='gcb-unit-title'>
          <p class="gcb-top-content">
            <span class="gcb-progress-empty"></span>
            Error: unit type not recognized.
      {% endif %}
          {% if not unit.now_available and is_course_admin %}
            (Private)
          {% endif %}
          </p>
        </li>
    {% endif %}
{%- endmacro %}


{#
# macro to render a lesson title along with a progress indicator
#}
{% macro render_lesson_title(
    page_type, unit, lesson, lesson_id, lesson_progress, is_progress_recorded, is_course_admin) -%}
  {% if lesson.now_available or is_course_admin %}

    <li {% if page_type == 'unit' and lesson.lesson_id == lesson_id %}class="active"{% endif %}>

      {% if is_progress_recorded %}
        <div class="gcb-progress-icon-holder">
          {% if lesson.lesson_id in lesson_progress and lesson_progress[lesson.lesson_id]['html'] == 2 %}
            <img src="assets/lib/completed.png"
                 alt="{# I18N: Alt text for image representing student progress. #}{{ gettext('Completed') }}"
                 title="{# I18N: Alt text for image representing student progress. #}{{ gettext('Completed') }}"
                 class="gcb-progress-icon"
                 id="progress-completed-{{lesson.lesson_id}}">
          {% elif lesson.lesson_id in lesson_progress and lesson_progress[lesson.lesson_id]['html'] == 1 %}
            <img src="assets/lib/in_progress.png"
                 alt="{# I18N: Alt text for image representing student progress. #}{{ gettext('In progress') }}"
                 title="{# I18N: Alt text for image representing student progress. #}{{ gettext('In progress') }}"
                 class="gcb-progress-icon"
                 id="progress-inprogress-{{lesson.lesson_id}}">
          {% else %}
            <img src="assets/lib/not_started.png"
                 alt="{# I18N: Alt text for image representing student progress. #}{{ gettext('Not yet started') }}"
                 title="{# I18N: Alt text for image representing student progress. #}{{ gettext('Not yet started') }}"
                 class="gcb-progress-icon"
                 id="progress-notstarted-{{lesson.lesson_id}}">
          {% endif %}
        </div>
      {% endif %}

      <div class="gcb-lesson-title-with-progress">
        {% if page_type == 'unit' and lesson.lesson_id == lesson_id %}
          {{ display_lesson_title(unit, lesson) }}
        {% else %}
          <a href="unit?unit={{ unit.unit_id }}&lesson={{ lesson.lesson_id }}">
            {{ display_lesson_title(unit, lesson) }}
          </a>
        {% endif %}
      </div>

    {% if not lesson.now_available and is_course_admin %}
      <span class="gcb-grayed">
        (Private)
      </span>
    {% endif %}

    {% if lesson.activity and lesson.activity_listed %}
      <ul>
        {% if page_type == 'activity' and lesson.lesson_id == lesson_id %}
          <li class="active">
        {% else %}
          <li>
        {% endif %}
            {% if is_progress_recorded %}
              <div class="gcb-progress-icon-holder">
                {% if lesson.lesson_id in lesson_progress and lesson_progress[lesson.lesson_id]['activity'] == 2 %}
                  <img src="assets/lib/completed.png"
                       alt="{# I18N: Alt text for image representing student progress. #}{{ gettext('Completed') }}"
                       title="{# I18N: Alt text for image representing student progress. #}{{ gettext('Completed') }}"
                       class="gcb-progress-icon"
                       id="progress-completed-{{lesson.lesson_id}}-activity">
                {% elif lesson.lesson_id in lesson_progress and lesson_progress[lesson.lesson_id]['activity'] == 1 %}
                  <img src="assets/lib/in_progress.png"
                       alt="{# I18N: Alt text for image representing student progress. #}{{ gettext('In progress') }}"
                       title="{# I18N: Alt text for image representing student progress. #}{{ gettext('In progress') }}"
                       class="gcb-progress-icon"
                       id="progress-inprogress-{{lesson.lesson_id}}-activity">
                {% else %}
                  <img src="assets/lib/not_started.png"
                       alt="{# I18N: Alt text for image representing student progress. #}{{ gettext('Not yet started') }}"
                       title="{# I18N: Alt text for image representing student progress. #}{{ gettext('Not yet started') }}"
                       class="gcb-progress-icon"
                       id="progress-notstarted-{{lesson.lesson_id}}-activity">
                {% endif %}
              </div>
            {% endif %}

            <div class="gcb-activity-title-with-progress">
              {% if page_type == 'activity' and lesson.lesson_id == lesson_id %}
                {# I18N: Menu item. #}
                {{ gettext('Activity') }}
              {% else %}
                <a href="activity?unit={{ unit.unit_id }}&lesson={{ lesson.lesson_id }}">
                  {# I18N: Menu item. #}
                  {{ gettext('Activity') }}
                </a>
              {% endif %}
            </div>
          </li>
      </ul>
    {% endif %}

    </li>

  {% else %}
    <li>
      {% if page_type == 'unit' and lesson.lesson_id == lesson_id %}
        <span class="gcb-grayed-active">
      {% else %}
        <span class="gcb-grayed">
      {% endif %}

        {{ lesson.index }} {{ lesson.title }}
      </span>

      {% if lesson.activity %}
        <ul>
          <li>
            <span class="gcb-progress-empty"></span>
            {% if page_type == 'activity' and lesson.lesson_id == lesson_id %}
              <span class="gcb-grayed-active">
            {% else %}
              <span class="gcb-grayed">
            {% endif %}

              {# I18N: Menu item. #}
              {{ gettext('Activity') }}

            </span>
          </li>
        </ul>
      {% endif %}
    </li>
  {% endif %}
{%- endmacro %}
