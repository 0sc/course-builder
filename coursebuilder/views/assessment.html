{% extends 'base.html' %}

{% block subtitle %}
  {% trans %} Assessment {% endtrans %}
{% endblock subtitle %}

{% block top_content %}
{% endblock %}

{% block main_content %}

{% if is_read_write_course and is_course_admin %}
  <a href="dashboard?action=edit_assessment&key={{ unit_id }}"
    class="gcb-button gcb-button-action">Edit assessment</a>
{% endif %}

<div class="gcb-main">
  <div class="gcb-article">
    {% if assessment_script_src %}
      <script src="{{ assessment_script_src }}"></script>
    {% elif assessment_script %}
      <script>{{ assessment_script | safe }}</script>
    {% endif %}
    <script>
      assessmentXsrfToken = '{{ assessment_xsrf_token }}';

      {% if reviewer_view is defined %}
        var isReviewAssessment = true;
        var reviewIndex = {{ review_index }};
        var unitId = '{{ unit_id }}';
      {% else %}
        var isReviewAssessment = false;
      {% endif %}

      {% if record_events %}
        gcbCanPostEvents = true;
        eventXsrfToken = '{{ event_xsrf_token }}';
      {% endif %}
    </script>

    {% if reviewer_view is defined %}
      <p>
        <a href="reviewdashboard?unit={{ unit_id }}">
          {{ gettext('Back to the review dashboard.') }}
        </a>
      </p>
    {% endif %}

    {% if readonly_student_assessment is defined %}
      {% if reviewer_view is not defined %}
        <p>
          <strong>
            {{ gettext('You have already submitted this assessment.') }}
          </strong>
        </p>
      {% endif %}
      <div class="border-box">
        {% set readonly_assessment = readonly_student_assessment %}
        {% include 'readonly_assessment.html' %}
      </div>
    {% endif %}

    {% if reviews_received is defined %}
      <h3>{{ gettext('Reviews received') }}</h3>
      {% for review in reviews_received %}
        <h4>Review {{ loop.index }}</h4>
        <div class="border-box">
          {% set readonly_assessment = review %}
          {% include 'readonly_assessment.html' %}
        </div>
      {% endfor %}
    {% endif %}

    {% if reviewer_view is defined %}
      <h3>{{ gettext('Review form') }}</h3>
    {% endif %}

    {% if readonly_review_form is defined %}
      <div class="border-box">
        {% set readonly_assessment = readonly_review_form %}
        {% include 'readonly_assessment.html' %}
      </div>
    {% endif %}

    <div style="width: 970px;" id="assessmentContents"></div>
  </div>
</div>

{% endblock %}
